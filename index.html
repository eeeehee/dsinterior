<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>대성기획인테리어 · 당신의 일상을 디자인합니다</title>
<!-- Fonts: SUIT + Cafe24Ssurround -->
<link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2201@1.0/Cafe24Ssurround.woff2" rel="stylesheet"/>
<!-- Favicon -->
<link rel="icon" type="image/jpeg" href="images/image_2.jpeg">
<style>
    :root{ --ink:#0b0d0e; --muted:#6b7280; --line:#e5e7eb; --bg:#ffffff; --bg-soft:#f8f9fb; }
    *{ box-sizing:border-box; }
    html,body{ margin:0; font-family:'SUIT','Pretendard','Noto Sans KR',system-ui,-apple-system,Segoe UI,Arial,sans-serif; color:var(--ink); background:var(--bg); }
    img{ max-width:100%; display:block; }

    header{ position:sticky; top:0; z-index:50; background:#fff; border-bottom:1px solid var(--line); }
    .nav{ max-width:1200px; margin:0 auto; padding:14px 18px; display:flex; align-items:center; justify-content:space-between; }
    .brand{ display:flex; align-items:center; gap:12px; }
    .brand img{ height:48px; width:auto; }
    .brand .name{ font-weight:800; letter-spacing:.02em; }
    .menu{ display:flex; gap:22px; list-style:none; margin:0; padding:0; }
    .menu a{ text-decoration:none; color:#111; font-weight:600; font-size:.98rem; }

    /* Hero with background */
    .hero{ position:relative; min-height:52vh; display:grid; place-items:center; text-align:center; border-bottom:1px solid var(--line); overflow:hidden; }
    .hero::before{ content:''; position:absolute; inset:0; background-image:url('images/image_1.jpeg'); background-size:cover; background-position:center; filter:brightness(0.78); }
    .hero::after{ content:''; position:absolute; inset:0; background:linear-gradient(0deg, rgba(0,0,0,.35), rgba(0,0,0,.15)); }
    .hero > div{ position:relative; z-index:1; color:#fff; }
    .hero h1{ font-family:'Cafe24Ssurround', sans-serif; font-weight:normal; letter-spacing:-0.01em; font-size:clamp(30px,6.4vw,66px); margin:0 12px 8px; }
    .hero .sub{ color:#e5e7eb; margin:0 12px 2px; }
    .hero .sub.en{ font-family:'SUIT', sans-serif; color:#d1d5db; font-size:1.02rem; }

    .wrap{ max-width:1200px; margin:0 auto; padding:72px 18px; }
    .section-title{ font-size:20px; letter-spacing:.16em; text-transform:uppercase; color:#111; margin:0 0 24px; }
    .lead{ color:#1f2937; font-size:1.05rem; line-height:1.7; }
    .thin-line{ height:1px; background:var(--line); margin:24px 0 18px; }

    .case-card{ display:flex; gap:16px; align-items:center; border:1px solid var(--line); background:#fff; border-radius:12px; padding:14px; text-decoration:none; color:inherit; cursor:pointer; }
    .case-card:hover{ box-shadow:0 10px 24px rgba(0,0,0,.06); }
    .thumb{ width:240px; height:150px; border-radius:10px; overflow:hidden; border:1px solid var(--line); }
    .thumb img{ width:100%; height:100%; object-fit:cover; }

    .modal{ position:fixed; inset:0; z-index:100; background:rgba(0,0,0,.78); display:none; align-items:center; justify-content:center; padding:32px 18px; }
    .modal.open{ display:flex; }
    .modal-card{ background:#fff; border-radius:16px; max-width:min(1200px,94vw); max-height:92vh; width:100%; overflow:hidden; display:flex; flex-direction:column; }
    .modal-head{ display:flex; align-items:center; justify-content:space-between; padding:14px 18px; border-bottom:1px solid var(--line); }
    .modal-title{ font-weight:800; }
    .modal-body{ padding:18px; overflow:auto; }
    .modal-close{ border:1px solid #d1d5db; background:#fff; border-radius:10px; padding:8px 12px; cursor:pointer; font-weight:700; }
    .modal-close:hover{ background:#111; color:#fff; border-color:#111; }

    .grid{ display:grid; gap:14px; grid-template-columns:repeat(auto-fill, minmax(260px,1fr)); }
    .tile{ border:1px solid var(--line); border-radius:10px; overflow:hidden; background:#fff; cursor:pointer; }
    .tile img{ width:100%; height:220px; object-fit:cover; }
    .tile figcaption{ font-size:.9rem; color:#374151; padding:10px 12px; border-top:1px solid var(--line); }

    .viewer{ position:fixed; inset:0; z-index:110; background:rgba(0,0,0,.85); display:none; align-items:center; justify-content:center; }
    .viewer.open{ display:flex; }
    .viewer .panel{ position:relative; max-width:min(92vw,1400px); max-height:88vh; }
    .viewer img{ width:auto; height:auto; max-width:100%; max-height:88vh; border-radius:8px; }
    .viewer .caption{ color:#e5e7eb; text-align:center; margin-top:10px; }
    .viewer .btn{ position:absolute; top:50%; transform:translateY(-50%); background:rgba(17,17,17,.6); color:#fff; border:1px solid rgba(255,255,255,.25); padding:10px 14px; border-radius:999px; cursor:pointer; user-select:none; }
    .viewer .prev{ left:-52px; } .viewer .next{ right:-52px; }
    .viewer .close{ top:12px; right:12px; transform:none; }
    @media (max-width:768px){ .viewer .prev{left:6px} .viewer .next{right:6px} }

    .services{ display:grid; gap:22px; grid-template-columns:repeat(auto-fit, minmax(280px,1fr)); }
    .svc{ position:relative; padding:22px; border:1px solid var(--line); border-radius:14px; background:#fff; }
    .svc .head{ display:flex; align-items:center; gap:10px; margin-bottom:8px; }
    .svc .icon{ width:26px; height:26px; display:grid; place-items:center; border-radius:8px; background:#0b0d0e; color:#fff; }
    .svc .badge{ display:inline-block; margin-top:8px; font-size:.72rem; letter-spacing:.06em; text-transform:uppercase; background:#f2f4f7; border:1px solid #e5e7eb; padding:4px 8px; border-radius:999px; }
    .svc p{ margin:12px 0 14px; color:#374151; line-height:1.7; }
    .svc ul{ margin:0; padding-left:18px; color:#4b5563; line-height:1.6; }

    footer{ background:#111418; color:#c7d0da; border-top:1px solid #222; margin-top:10px; }
    .foot{ max-width:1200px; margin:0 auto; padding:30px 18px; display:grid; gap:18px; grid-template-columns:1.1fr 2fr; align-items:center; }
    .foot .fbrand{ display:flex; align-items:center; gap:12px; }
    .foot .fbrand img{ height:44px; }
    .foot .name{ color:#fff; font-weight:900; }
    .foot .slogan{ color:#9fb2c2; font-size:.9rem; }
    .biz{ color:#96a1ad; line-height:1.8; }
    .copy{ text-align:center; color:#7e8b97; padding:14px; border-top:1px solid #1b1f24; font-size:.9rem; }
    @media (max-width:860px){ .foot{ grid-template-columns:1fr; text-align:center; } .foot .fbrand{ justify-content:center; } }
  </style>
<style>
/* --- Scoped UI styles for 견적문의/게시판 모듈 --- */
:root { --pri:#fbbf24; --bg:#0b0b0c; --fg:#f7f7f7; --muted:#999; }
/* 모달 팝업 게시판 */
.emodal-mask{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;z-index:9999;align-items:center;justify-content:center;padding:20px;overflow-y:auto}
.emodal-mask.show{display:flex}
.emodal{max-width:1200px;width:100%;background:#fff;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,0.3);padding:40px;max-height:90vh;overflow-y:auto}
.emodal header{padding:0 0 20px 0;border-bottom:2px solid #e5e7eb;display:flex;align-items:center;justify-content:space-between;margin-bottom:30px;position:relative}
.emodal header h3{margin:0;font-size:2rem;font-weight:800}
/* 등록 모달 */
.write-modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:999999;padding:20px}
.write-modal.show{display:flex}
.write-modal-box{background:#fff;border-radius:12px;width:100%;max-width:600px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.3)}
.write-modal-header{padding:24px 28px;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center}
.write-modal-header h4{font-size:1.5rem;font-weight:700;margin:0}
.write-modal-body{padding:28px}
.write-modal-footer{padding:20px 28px;border-top:1px solid #e5e7eb;display:flex;justify-content:flex-end;gap:12px}
/* 견적서 작성 모달 */
.quote-modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:999999;padding:20px;overflow-y:auto}
.quote-modal.show{display:flex}
.quote-modal-box{background:#fff;border-radius:12px;width:100%;max-width:900px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.3)}
.quote-modal-header{padding:24px 28px;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center}
.quote-modal-header h4{font-size:1.5rem;font-weight:700;margin:0}
.quote-modal-body{padding:28px}
.quote-modal-footer{padding:20px 28px;border-top:1px solid #e5e7eb;display:flex;justify-content:flex-end;gap:12px}
.form-section{margin-bottom:28px;padding-bottom:20px;border-bottom:1px solid #f0f0f0}
.form-section:last-child{border-bottom:none}
.form-section h5{font-size:1.1rem;font-weight:700;margin:0 0 16px;color:#111}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.form-group{margin-bottom:16px}
.form-group label{display:block;margin-bottom:6px;font-weight:600;color:#374151;font-size:0.95rem}
.req{color:#ef4444;font-weight:bold}
.quote-item{margin-bottom:12px;padding:12px;background:#f9fafb;border-radius:8px;border:1px solid #e5e7eb}
.item-row{display:grid;grid-template-columns:2fr 1.5fr 0.8fr 1.2fr 1.2fr 40px;gap:10px;align-items:center}
.item-row input{padding:8px 10px;font-size:0.9rem}
.item-total{font-weight:700;color:#3b82f6;text-align:right}
.btn-remove{background:#ef4444;color:#fff;border:none;width:32px;height:32px;border-radius:6px;cursor:pointer;font-size:1.2rem;display:flex;align-items:center;justify-content:center}
.btn-remove:hover{background:#dc2626}
.total-info{background:#f8f9fb;padding:20px;border-radius:12px;border:1px solid #e5e7eb}
.total-row{display:flex;justify-content:space-between;padding:10px 0;font-size:1rem;color:#374151}
.total-final{border-top:2px solid #3b82f6;margin-top:10px;padding-top:16px;font-size:1.3rem;font-weight:700;color:#111}
.total-final span:last-child{color:#3b82f6}
@media (max-width:768px){
.item-row{grid-template-columns:1fr;gap:8px}
.item-total{text-align:left}
.form-row{grid-template-columns:1fr}
}
.close-btn{background:none;border:none;font-size:1.5rem;color:#6b7280;cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:4px}
.close-btn:hover{background:#f3f4f6;color:#0b0d0e}
.close-x{background:none;border:none;font-size:1.8rem;color:#6b7280;cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:4px}
.close-x:hover{background:#f3f4f6;color:#0b0d0e}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid #ddd;background:#fff;cursor:pointer;transition:.2s}
.btn.pri{background:#3b82f6;border-color:#3b82f6;color:#fff;box-shadow:0 2px 6px rgba(59,130,246,.2)}
.btn.pri:hover{background:#2563eb;transform:translateY(-1px)}
.btn.ghost{background:transparent;border-color:#ccc;color:#333}
.btn.ghost:hover{border-color:#3b82f6;background:#eff6ff}
.badge{font-size:12px;padding:2px 8px;border-radius:999px;background:#f1f1f1}
.comment-badge{position:absolute;top:-8px;right:-8px;display:inline-flex;align-items:center;justify-content:center;min-width:20px;height:20px;padding:0 5px;background:#ef4444;color:#fff;border-radius:50%;font-size:10px;font-weight:700;box-shadow:0 2px 4px rgba(239,68,68,0.4);border:2px solid #fff}
.toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
input[type=text],input[type=password],input[type=email],textarea{width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:10px;outline:none}
textarea{min-height:110px;resize:vertical}
.table{width:100%;border-collapse:collapse;margin-top:8px;background:#fff;border:1px solid #e5e7eb;border-radius:8px;table-layout:fixed}
.table thead{background:#f8f9fb}
.table th,.table td{padding:12px 10px;border-bottom:1px solid #eee;text-align:left;font-size:14px;vertical-align:middle}
.table tbody tr{transition:.15s}
.table tbody tr:hover{background:#fffbeb}
.space-badge{display:inline-block;padding:4px 10px;background:#fef3c7;color:#92400e;border-radius:4px;font-size:.85rem;font-weight:600}
.pager{display:flex;gap:6px;justify-content:center;align-items:center;margin:18px 0}
.pager button{min-width:36px;height:36px;border-radius:10px;border:1px solid #ddd;background:#fff;cursor:pointer}
.pager button.active{background:#111;color:#fff;border-color:#111}
.kebab{cursor:pointer;padding:4px 8px;border-radius:8px;border:1px dashed transparent}
.kebab:hover{border-color:#ddd}
.tag{background:#f6f6f6;border:1px solid #eee;border-radius:10px;padding:2px 8px;font-size:12px}
.empty{padding:26px;text-align:center;color:#666}
.admin-bar{background:#fff;color:#111827;display:none;align-items:center;justify-content:space-between;padding:16px 20px;border-radius:12px;margin:0 0 20px 0;box-shadow:0 2px 8px rgba(0,0,0,.06);border:1px solid #e5e7eb}
.admin-bar .badge{background:#3b82f6;color:#fff;font-weight:600;padding:5px 12px;font-size:11px}
.admin-bar .btn.ghost{background:#f3f4f6;color:#6b7280;border:1px solid #e5e7eb}
.admin-bar .btn.ghost:hover{background:#e5e7eb;color:#374151}
.admin-bar .btn{background:#3b82f6;color:#fff;border:1px solid #3b82f6}
.admin-bar .btn:hover{background:#2563eb}
.hide{display:none !important}
/* small screens */
@media (max-width:720px){
  .grid{grid-template-columns:1fr}
  .emodal{width:94vw}
}

/* Safety: never alter page background */
html,body{background:unset !important;}

/* Ensure our modal stacks above site */
.emodal-mask{z-index: 999999}
/* Do NOT override global page background */
html,body{background:unset!important;}

/* ---- UI Polish v4 ---- */
/* emodal background은 위에서 #fff로 설정됨 */
.emodal header{background:transparent; position:relative; z-index:1; border:none;}
.emodal .body{padding:20px 24px 26px}
h4{margin:6px 0 10px 0; font-size:16px}
label{display:block; font-weight:600; margin:8px 0 6px}
.help{display:block; color:#777; font-size:12px; margin-top:4px}
.input-row{display:flex; gap:10px; align-items:center}
.input-row > *{flex:1}
.counter{font-size:12px; color:#777; text-align:right; margin-top:4px}
input, textarea{font-size:14px}
.btn{height:40px}
.btn-small{height:32px; padding:6px 14px; border-radius:10px; white-space:nowrap; min-width:50px;}
.table-wrap{overflow:auto; border:1px solid #eee; border-radius:12px}
.table{min-width:760px}
.badge.success{background:#eaf8ef; color:#227a3b; border:1px solid #bfe7cc}
.toast{position:fixed; left:50%; bottom:24px; transform:translateX(-50%); background:#111; color:#fff; padding:10px 14px; border-radius:12px; opacity:0; pointer-events:none; transition:.3s}
.toast.show{opacity:1}
/* comment list cards */
.comment{border:1px solid #eee; border-radius:12px; padding:10px 12px; margin:8px 0; background:#fff}
.comment .head{display:flex; align-items:center; justify-content:space-between}
.avatar{width:28px; height:28px; border-radius:50%; background:#f1f1f1; display:inline-flex; align-items:center; justify-content:center; font-size:12px; margin-right:8px}
@media (max-width:720px){
  .grid{grid-template-columns:1fr}
  .emodal{width:96vw; padding:20px;}
  
  /* 헤더 최적화 */
  .nav{padding:12px 16px; flex-wrap:wrap;}
  .brand{width:100%; justify-content:center; margin-bottom:12px;}
  .brand img{height:38px;}
  .brand .name{font-size:0.95rem;}
  .brand > div > div:last-child{font-size:0.65rem;}
  
  /* 메뉴 최적화 */
  .menu{width:100%; justify-content:space-around; gap:8px; flex-wrap:wrap;}
  .menu li{flex:1; min-width:80px; text-align:center;}
  .menu a{font-size:0.85rem; padding:8px 4px; display:block;}
  
  /* Hero 섹션 */
  .hero{min-height:40vh; padding:20px;}
  .hero h1{font-size:clamp(20px, 6.5vw, 40px) !important; line-height:1.3;}
  .hero .sub{
    font-size:clamp(7px, 1.8vw, 13px) !important; 
    white-space:nowrap !important; 
    letter-spacing:-0.03em !important;
    display:inline-block !important;
    max-width:100% !important;
  }
  .hero .sub.en{
    font-size:clamp(8px, 2vw, 14px) !important; 
    white-space:nowrap !important; 
    letter-spacing:-0.02em !important;
    display:inline-block !important;
    max-width:100% !important;
  }
  
  /* 컨텐츠 섹션 */
  .wrap{padding:40px 16px !important;}
  .section-title{font-size:1.5rem !important;}
  
  /* 서비스 그리드 */
  .services{grid-template-columns:1fr !important; gap:16px;}
  .svc{padding:20px !important;}
  
  /* 시공사례 카드 */
  .case-card{flex-direction:column !important;}
  .case-card .thumb{width:100% !important; height:auto !important;}
  
  /* ========== 견적 관련 모달 모바일 최적화 ========== */
  
  /* 견적문의 메인 모달 */
  .emodal-mask{padding:8px; align-items:flex-start; padding-top:20px;}
  .emodal{
    max-height:calc(100vh - 40px);
    padding:12px;
    margin:0;
    overflow-x:hidden !important;
    overflow-y:auto !important;
    width:calc(100vw - 16px) !important;
    box-sizing:border-box !important;
  }
  .emodal header{
    padding:0 0 12px 0;
    margin-bottom:12px;
  }
  .emodal header h3{
    font-size:1.4rem;
  }
  .emodal .body{
    padding:0 10px !important;
    overflow-x:hidden !important;
  }
  
  /* 견적 등록 모달 */
  .write-modal{padding:10px; align-items:flex-start; padding-top:20px;}
  .write-modal-box{
    max-width:100%;
    max-height:calc(100vh - 40px);
    margin:0;
  }
  .write-modal-header{
    padding:16px 20px;
  }
  .write-modal-header h4{
    font-size:1.3rem;
  }
  .write-modal-body{
    padding:20px !important;
  }
  .write-modal-body > div{
    margin-bottom:20px !important;
  }
  .write-modal-body label{
    font-size:0.95rem;
    margin-bottom:8px;
    display:block;
  }
  .write-modal-body input,
  .write-modal-body textarea{
    width:100%;
    padding:12px 14px;
    font-size:16px !important;
    border-radius:10px;
    border:1px solid #ddd;
  }
  .write-modal-body textarea{
    min-height:120px;
  }
  .write-modal-footer{
    padding:16px 20px;
    gap:10px;
  }
  .write-modal-footer .btn{
    flex:1;
    justify-content:center;
    min-height:48px;
    font-size:1rem;
  }
  
  /* 견적서 작성 모달 */
  .quote-modal{padding:10px; align-items:flex-start; padding-top:20px;}
  .quote-modal-box{
    max-width:100%;
    max-height:calc(100vh - 40px);
    margin:0;
  }
  .quote-modal-header{
    padding:16px 20px;
  }
  .quote-modal-header h4{
    font-size:1.3rem;
  }
  .quote-modal-body{
    padding:20px !important;
  }
  
  /* 폼 섹션 */
  .form-section{
    margin-bottom:24px;
    padding-bottom:20px;
  }
  .form-section h5{
    font-size:1.1rem;
    margin-bottom:16px;
  }
  .form-row{
    grid-template-columns:1fr !important;
    gap:16px;
  }
  .form-group{
    margin-bottom:16px;
  }
  .form-group label{
    font-size:0.95rem;
    margin-bottom:8px;
  }
  .form-group input,
  .form-group textarea{
    width:100%;
    padding:12px 14px;
    font-size:16px !important;
    border-radius:10px;
  }
  
  /* 견적 항목 (item-row) 최적화 */
  .quote-item{
    margin-bottom:16px;
    padding:16px;
    background:#f9fafb;
    border-radius:12px;
  }
  .item-row{
    display:grid !important;
    grid-template-columns:1fr !important;
    gap:10px !important;
  }
  .item-row input{
    width:100%;
    padding:12px 14px !important;
    font-size:16px !important;
    border-radius:8px;
  }
  .item-row input::placeholder{
    font-size:0.9rem;
    color:#9ca3af;
  }
  .item-total{
    text-align:left !important;
    padding:12px 14px;
    background:#e0f2fe;
    border-radius:8px;
    font-size:1rem;
    font-weight:700;
    color:#0369a1;
  }
  .btn-remove{
    width:100% !important;
    height:44px !important;
    border-radius:10px;
    font-size:1.1rem;
    margin-top:4px;
  }
  
  /* 총액 정보 */
  .total-info{
    padding:16px;
    margin-top:20px;
  }
  .total-row{
    padding:10px 0;
    font-size:1rem;
  }
  .total-final{
    font-size:1.2rem !important;
    padding-top:16px;
  }
  
  .quote-modal-footer{
    padding:16px 20px;
    flex-direction:column;
    gap:10px;
  }
  .quote-modal-footer .btn{
    width:100%;
    justify-content:center;
    min-height:48px;
    font-size:1rem;
  }
  .table-wrap{
    border:none !important;
    overflow:visible !important;
    margin:0 !important;
    padding:0 !important;
    width:100% !important;
    max-width:100% !important;
    box-sizing:border-box !important;
  }
  
  .table{
    border:none !important;
    display:block !important;
    width:100% !important;
    max-width:100% !important;
    box-sizing:border-box !important;
  }
  
  .table thead{
    display:none !important;
  }
  
  .table tbody{
    display:block !important;
    width:100% !important;
    max-width:100% !important;
    box-sizing:border-box !important;
  }
  
  .table tbody tr{
    display:block !important;
    position:relative;
    width:100% !important;
    max-width:100% !important;
    margin:0 0 8px 0 !important;
    border:1px solid #e5e7eb;
    border-radius:8px;
    padding:8px 10px 8px 10px !important;
    padding-right:50px !important;
    background:#fff;
    box-shadow:0 1px 3px rgba(0,0,0,0.06);
    box-sizing:border-box !important;
    min-height:auto !important;
    overflow:hidden !important;
  }
  
  .table tbody tr:hover{
    background:#fffbeb;
  }
  
  .table tbody td{
    display:block !important;
    border:none !important;
    padding:1px 0 !important;
    margin:0 !important;
    text-align:left !important;
    font-size:10px !important;
    line-height:1.3 !important;
    word-break:normal !important;
    white-space:normal !important;
    max-width:100% !important;
    box-sizing:border-box !important;
  }
  
  /* 체크박스 - 이름 앞에 인라인으로 */
  .table tbody td:nth-child(1){
    display:inline-block !important;
    vertical-align:middle !important;
    margin:0 4px 0 0 !important;
    padding:0 !important;
  }
  
  /* No는 숨김 */
  .table tbody td:nth-child(2){
    display:none !important;
  }
  
  /* 이름 - 체크박스 옆에 인라인으로 */
  .table tbody td:nth-child(3){
    display:inline-block !important;
    font-size:12px !important;
    font-weight:700 !important;
    color:#111 !important;
    margin:0 0 1px 0 !important;
    line-height:1.3 !important;
    vertical-align:middle !important;
    max-width:calc(100% - 70px) !important;
    overflow:hidden !important;
    text-overflow:ellipsis !important;
    white-space:nowrap !important;
  }
  
  /* 연락처 */
  .table tbody td:nth-child(4){
    font-size:10px !important;
    color:#6b7280 !important;
    margin:0 0 1px 0 !important;
    line-height:1.3 !important;
    white-space:nowrap !important;
    overflow:hidden !important;
    text-overflow:ellipsis !important;
    max-width:calc(100% - 10px) !important;
  }
  
  /* 공간 타입 */
  .table tbody td:nth-child(5){
    font-size:9px !important;
    color:#059669 !important;
    font-weight:600 !important;
    margin:0 0 1px 0 !important;
    line-height:1.3 !important;
    max-width:calc(100% - 10px) !important;
  }
  .table tbody td:nth-child(5) .space-badge{
    display:inline-block;
    padding:1px 4px !important;
    font-size:8px !important;
    background:#fef3c7 !important;
    color:#92400e !important;
    border-radius:3px !important;
    border:none !important;
    line-height:1.2 !important;
    max-width:100% !important;
    overflow:hidden !important;
    text-overflow:ellipsis !important;
    white-space:nowrap !important;
  }
  
  /* 내용 - 무조건 1줄만 표시 */
  .table tbody td:nth-child(6){
    display:block !important;
    max-width:calc(100% - 10px) !important;
    overflow:hidden !important;
    text-overflow:ellipsis !important;
    white-space:nowrap !important;
    font-size:9px !important;
    color:#9ca3af !important;
    line-height:1.3 !important;
    margin:0 0 1px 0 !important;
    -webkit-line-clamp:unset !important;
    -webkit-box-orient:unset !important;
  }
  
  /* 등록일 - 매우 작고 연하게 */
  .table tbody td:nth-child(7){
    font-size:8px !important;
    color:#d1d5db !important;
    margin:0 !important;
    line-height:1.3 !important;
    white-space:nowrap !important;
    overflow:hidden !important;
    text-overflow:ellipsis !important;
    max-width:calc(100% - 10px) !important;
  }
  
  /* 상태 - 오른쪽 상단 */
  .table tbody td:nth-child(8){
    position:absolute !important;
    top:8px !important;
    right:8px !important;
    padding:0 !important;
    margin:0 !important;
  }
  .table tbody td:nth-child(8) .badge{
    font-size:8px !important;
    padding:2px 5px !important;
    line-height:1.2 !important;
  }
  
  /* 체크박스 크기 */
  input[type="checkbox"]{
    width:14px;
    height:14px;
    cursor:pointer;
    margin:0;
    vertical-align:middle;
  }
  
  /* 버튼 및 툴바 */
  .btn{font-size:0.9rem; padding:12px 16px; min-height:44px; box-sizing:border-box;} /* 최소 터치 크기 */
  .toolbar{
    flex-direction:column; 
    gap:8px; 
    width:100% !important; 
    max-width:100% !important; 
    box-sizing:border-box !important;
    padding:0 !important;
  }
  .toolbar input, .toolbar button{
    width:100%; 
    max-width:100% !important; 
    box-sizing:border-box !important;
  }
  
  /* 닫기 버튼 터치 영역 확대 */
  .close-btn, .close-x{
    width:44px !important;
    height:44px !important;
    font-size:1.8rem;
  }
  
  /* 관리자 바 */
  .admin-bar{flex-direction:column; gap:12px; align-items:stretch; padding:12px 16px;}
  .admin-bar .btn{width:100%; justify-content:center; min-height:44px;}
  
  /* ========== 추가 모바일 최적화 ========== */
  
  /* 공개 설정 토글 스타일 */
  .write-modal-body > div:first-child{
    padding:14px !important;
    border-radius:10px;
  }
  .write-modal-body label[style*="cursor:pointer"]{
    font-size:1rem !important;
  }
  
  /* 입력 필드 포커스 스타일 */
  input:focus, textarea:focus{
    outline:none;
    border-color:#3b82f6 !important;
    box-shadow:0 0 0 3px rgba(59, 130, 246, 0.1);
  }
  
  /* 버튼 액티브 상태 */
  .btn:active{
    transform:scale(0.98);
  }
  
  /* 스크롤 최적화 */
  .emodal, .write-modal-box, .quote-modal-box{
    -webkit-overflow-scrolling:touch;
  }
  
  /* help 텍스트 */
  .help{
    font-size:0.85rem !important;
    margin-top:6px;
    color:#6b7280;
  }
  
  /* counter 텍스트 */
  .counter{
    font-size:0.85rem !important;
    color:#6b7280;
  }
  
  /* 상세보기 모달 */
  .emodal .body{padding:16px 20px;}
  
  /* 상세보기 모달 - 모바일 폰트 크기 */
  .detail-modal-content{padding:20px !important;}
  .detail-modal-title{
    font-size:1.3rem !important;
    margin-bottom:20px !important;
  }
  .detail-info-grid{
    padding:16px !important;
    margin-bottom:20px !important;
  }
  .detail-info-grid > div{
    grid-template-columns:1fr !important;
    gap:16px !important;
  }
  .detail-label{
    font-size:0.8rem !important;
    margin-bottom:6px !important;
  }
  .detail-value{
    font-size:1rem !important;
  }
  .detail-content{
    font-size:1rem !important;
    padding:16px !important;
    line-height:1.7 !important;
  }
  
  /* 댓글 섹션 */
  .detail-comments{
    margin-top:20px !important;
    padding-top:20px !important;
  }
  .detail-comments strong{
    font-size:0.85rem !important;
  }
  
  /* 댓글 아이템 */
  .comment-item{
    padding:12px !important;
    margin-bottom:10px !important;
  }
  .comment-header{
    margin-bottom:8px !important;
  }
  .comment-author{
    font-size:0.95rem !important;
  }
  .comment-date{
    font-size:0.75rem !important;
  }
  .comment-text{
    font-size:0.95rem !important;
    line-height:1.6 !important;
  }
  .no-comments{
    font-size:0.9rem !important;
    padding:16px !important;
  }
  .detail-comments input{
    font-size:1rem !important;
    padding:10px 12px !important;
  }
  .detail-comments button{
    font-size:0.9rem !important;
    padding:10px 16px !important;
  }
  
  /* 닫기 버튼 */
  .detail-close-btn{
    font-size:1rem !important;
    padding:12px 24px !important;
    min-height:44px;
  }
  
  /* 푸터 */
  .foot{padding:30px 20px !important; font-size:0.85rem;}
  
  /* 폼 요소 - iOS zoom 방지 */
  input, textarea, select{font-size:16px !important; min-height:44px;}
  
  /* Pager 버튼 */
  .pager button{min-width:44px; height:44px;}
}

/* 태블릿 (721px ~ 1024px) */
@media (max-width:1024px) and (min-width:721px){
  .nav{padding:14px 20px;}
  .wrap{padding:60px 30px;}
  .services{grid-template-columns:repeat(2, 1fr);}
  .hero h1{font-size:clamp(36px, 5vw, 56px);}
}

/* 아주 작은 화면 (480px 이하) */
@media (max-width:480px){
  .nav{padding:10px 12px;}
  .brand img{height:32px;}
  .brand .name{font-size:0.85rem;}
  
  .hero{min-height:35vh; padding:16px;}
  .hero h1{font-size:clamp(20px, 9vw, 32px) !important;}
  .hero .sub{font-size:0.75rem;}
  
  .wrap{padding:32px 12px !important;}
  .section-title{font-size:1.3rem !important;}
  
  .menu{gap:4px;}
  .menu a{font-size:0.75rem; padding:6px 2px;}
  
  /* 카드형 테이블 더 작게 */
  .table tbody tr{padding:12px; margin-bottom:12px;}
  .table tbody td{padding:6px 0 !important; font-size:13px !important;}
  
  /* 상세보기 모달 더 작게 */
  .detail-modal-content{padding:16px !important;}
  .detail-modal-title{font-size:1.1rem !important;}
  .detail-info-grid{padding:12px !important;}
  .detail-label{font-size:0.75rem !important;}
  .detail-value{font-size:0.95rem !important;}
  .detail-content{font-size:0.95rem !important; padding:12px !important;}
  
  /* 댓글 더 작게 */
  .comment-item{padding:10px !important;}
  .comment-author{font-size:0.9rem !important;}
  .comment-date{font-size:0.7rem !important;}
  .comment-text{font-size:0.9rem !important;}
  
  /* 닫기 버튼 */
  .detail-close-btn{
    font-size:0.9rem !important;
    padding:10px 20px !important;
  }
  
  .emodal .body{padding:12px 16px;}
  .btn{font-size:0.85rem; padding:10px 12px;}
}



</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

</head>
<body>
<header>
<div class="nav">
<div class="brand"><img alt="대성기획인테리어 로고" src="images/image_2.jpeg"/><div><div class="name">대성기획인테리어</div><div style="font-size:0.75rem;color:#6b7280;margin-top:2px;letter-spacing:0.02em;">Designing Your Everyday Life</div></div></div>
<ul class="menu"><li><a href="#work">포트폴리오</a></li><li><a href="#services">서비스</a></li><a href="#" id="openEstimateBtn">견적요청</a><li><a href="#contact">문의</a></li></ul>
</div>
</header>
<section class="hero" id="home">
<div>
<h1>당신의 일상을 디자인합니다</h1>
<p class="sub">대성기획인테리어 · DAESUNG INTERIOR</p>
<p class="sub en">Designing Your Everyday Life</p>
</div>
</section>
<section class="wrap" id="work">
<h2 class="section-title">시공 사례</h2>
<div class="thin-line"></div>
<div class="case-card" id="open-case">
<div class="thumb"><img alt="풍동-33평 아파트 썸네일" src="images/image_3.jpeg"/></div>
<div>
<h3 style="margin:0 0 6px">풍동-33평 아파트 인테리어</h3>
<p style="margin:0;color:#4b5563">클릭하면 상세 사진을 모달로 확인할 수 있습니다.</p>
</div>
</div>
</section>
<section class="wrap" id="services">
<h2 class="section-title">SERVICES</h2>
<div class="thin-line"></div>
<div class="services">
<div class="svc">
<div class="head"><div aria-hidden="true" class="icon"><svg fill="none" height="16" viewbox="0 0 24 24" width="16"><path d="M3 10.5 12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-7H9v7H4a1 1 0 0 1-1-1v-10.5Z" stroke="currentColor" stroke-linejoin="round" stroke-width="1.6"></path></svg></div><h3>주거 공간</h3></div>
<span class="badge">Residential</span>
<p>아파트·빌라 리모델링, 주방·욕실 프리미엄 시공, 맞춤 수납/조명 설계.</p>
<ul><li>전체/부분 리모델링</li><li>주방·욕실 시공</li><li>수납/조명 설계</li></ul>
</div>
<div class="svc">
<div class="head"><div aria-hidden="true" class="icon"><svg fill="none" height="16" viewbox="0 0 24 24" width="16"><path d="M3 10h18l-1.2-6H4.2L3 10Zm0 0v9a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1v-9M7 20v-6h10v6" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"></path></svg></div><h3>상업 공간</h3></div>
<span class="badge">Commercial</span>
<p>브랜드 경험을 극대화하는 동선/소재/조명 전략으로 매출로 이어지는 공간을 만듭니다.</p>
<ul><li>카페·레스토랑·리테일</li><li>VMD/사이니지/간판</li><li>오피스 브랜딩</li></ul>
</div>
<div class="svc">
<div class="head"><div aria-hidden="true" class="icon"><svg fill="none" height="16" viewbox="0 0 24 24" width="16"><path d="M3 8h10M3 12h10M3 16h10M17 3l4 4-9 9-4 1 1-4 8-8Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6"></path></svg></div><h3>맞춤 설계</h3></div>
<span class="badge">Planning &amp; Design</span>
<p>컨셉 수립부터 3D 시뮬레이션, 예산/일정 관리까지 One-Stop으로 진행합니다.</p>
<ul><li>3D/VR 시뮬레이션</li><li>소재·가구·조명 컨설팅</li><li>공정/예산/일정 관리</li></ul>
</div>
</div>
</section>
<section class="wrap" id="contact" style="background:#0d1117; color:#e8eef4; border-top:1px solid #222; border-bottom:1px solid #222;">
<h2 class="section-title" style="color:#fff;">CONTACT</h2>
<p class="lead" style="color:#b7c1cc;">빠른 상담을 원하시면 아래 연락처로 문의 주세요.<br/>이메일 문의는 영업일 기준 이틀 내로 회신 드리겠습니다.<br/>상세한 문의는 견적요청으로 주시면 빠르고 자세하게 답변드리겠습니다!</p>
<div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:10px;">
<a class="svc" href="tel:010-3345-2259" style="text-decoration:none;border:1px solid #cfd6de;padding:10px 14px;border-radius:10px;color:#fff;background:transparent">전화 연결</a>
<a class="svc" href="mailto:yyk2400@naver.com" style="text-decoration:none;border:1px solid #cfd6de;padding:10px 14px;border-radius:10px;color:#fff;background:transparent">이메일</a>
</div>
</section>
<footer>
<div class="foot">
<div class="fbrand"><img alt="대성기획인테리어 로고" src="images/image_4.jpeg"/><div><div class="name">대성기획인테리어</div><div class="slogan">당신의 일상을 디자인합니다</div></div></div>
<div class="biz">사업자등록번호: 612-59-01057<br/>대표자: 윤영권<br/>이메일주소: yyk2400@naver.com<br/>주소: 경기도 고양시 일산동구 백석로85번길 19-11, 3층(백석동)</div>
</div>
<div class="copy">© 2025 Daesung Interior. All Rights Reserved.</div>
</footer>
<!-- Modal with gallery -->
<div aria-hidden="true" aria-label="풍동-33평 아파트 인테리어 갤러리" class="modal" id="caseModal" role="dialog">
<div class="modal-card">
<div class="modal-head">
<div class="modal-title">시공 사례 · 풍동-33평 아파트 인테리어</div>
<button class="modal-close" id="closeModal">닫기</button>
</div>
<div class="modal-body">
<div class="grid" id="modalGrid">
<figure class="tile" data-index="0"><img alt="도면" src="images/image_5.jpeg"/><figcaption>도면</figcaption></figure>
<figure class="tile" data-index="1"><img alt="거실 전경" src="images/image_6.jpeg"/><figcaption>거실 전경</figcaption></figure>
<figure class="tile" data-index="2"><img alt="주방/식당" src="images/image_7.jpeg"/><figcaption>주방/식당</figcaption></figure>
<figure class="tile" data-index="3"><img alt="싱크 하부 수납" src="images/image_8.jpeg"/><figcaption>싱크 하부 수납</figcaption></figure>
<figure class="tile" data-index="4"><img alt="주방 시공" src="images/image_9.jpeg"/><figcaption>주방 시공</figcaption></figure>
<figure class="tile" data-index="5"><img alt="안방" src="images/image_10.jpeg"/><figcaption>안방</figcaption></figure>
<figure class="tile" data-index="6"><img alt="식탁 자리" src="images/image_11.jpeg"/><figcaption>식탁 자리</figcaption></figure>
<figure class="tile" data-index="7"><img alt="욕실" src="images/image_12.jpeg"/><figcaption>욕실</figcaption></figure>
<figure class="tile" data-index="8"><img alt="현관/중문" src="images/image_13.jpeg"/><figcaption>현관/중문</figcaption></figure>
</div>
</div>
</div>
</div>
<!-- Lightbox viewer (inside modal) -->
<div aria-hidden="true" class="viewer" id="viewer">
<div class="panel">
<button class="btn close" id="vClose">✕</button>
<button class="btn prev" id="vPrev">‹</button>
<img alt="preview" id="vImg"/>
<button class="btn next" id="vNext">›</button>
<div class="caption" id="vCap"></div>
</div>
</div>
<script>
    // Open/close modal
    const openBtn = document.getElementById('open-case');
    const modal = document.getElementById('caseModal');
    const closeModal = document.getElementById('closeModal');
    openBtn.addEventListener('click', () => { modal.classList.add('open'); document.body.style.overflow = 'hidden'; });
    closeModal.addEventListener('click', () => { modal.classList.remove('open'); document.body.style.overflow = ''; });
    modal.addEventListener('click', (e) => { if (e.target === modal) { modal.classList.remove('open'); document.body.style.overflow = ''; } });

    // Viewer(lightbox) inside modal
    const tiles = Array.from(document.querySelectorAll('#modalGrid .tile'));
    const viewer = document.getElementById('viewer');
    const vImg = document.getElementById('vImg');
    const vCap = document.getElementById('vCap');
    const vPrev = document.getElementById('vPrev');
    const vNext = document.getElementById('vNext');
    const vClose = document.getElementById('vClose');
    let vIndex = 0;

    function showViewer(i){
      if (i < 0) i = tiles.length - 1;
      if (i >= tiles.length) i = 0;
      vIndex = i;
      const el = tiles[i];
      const src = el.querySelector('img').src;
      const cap = el.querySelector('figcaption').textContent;
      vImg.src = src;
      vImg.alt = cap;
      vCap.textContent = cap + ' (' + (i+1) + '/' + tiles.length + ')';
      viewer.classList.add('open');
    }
    function hideViewer(){ viewer.classList.remove('open'); }

    tiles.forEach((el, i) => el.addEventListener('click', () => showViewer(i)));
    vPrev.addEventListener('click', (e) => { e.stopPropagation(); showViewer(vIndex - 1); });
    vNext.addEventListener('click', (e) => { e.stopPropagation(); showViewer(vIndex + 1); });
    vClose.addEventListener('click', (e) => { e.stopPropagation(); hideViewer(); });
    viewer.addEventListener('click', (e) => { if (e.target === viewer) hideViewer(); });

    document.addEventListener('keydown', (e) => {
      if (viewer.classList.contains('open')){
        if (e.key === 'Escape') hideViewer();
        if (e.key === 'ArrowLeft') showViewer(vIndex - 1);
        if (e.key === 'ArrowRight') showViewer(vIndex + 1);
      } else if (modal.classList.contains('open')) {
        if (e.key === 'Escape') { modal.classList.remove('open'); document.body.style.overflow=''; }
      }
    });
  </script>
<div id="estimateComponentsMount">
<div aria-hidden="true" class="emodal-mask" id="estimateModalMask">
<div aria-labelledby="estimateModalTitle" aria-modal="true" class="emodal" role="dialog">
<header>
<h3 id="estimateModalTitle">견적문의</h3>
<div>
<span class="badge" id="estimateCountBadge">총 0건</span>
<button aria-label="닫기" class="btn ghost" id="closeEstimateModal">닫기</button>
</div>
</header>
<div class="body">
<div class="admin-bar" id="adminBar">
<div>관리자 모드 <span class="badge">ON</span></div>
<div class="toolbar">
<button class="btn ghost" id="createQuoteBtn">견적서 작성</button>
<button class="btn ghost" id="adminHideToggled">선택 숨김/해제</button>
<button class="btn ghost" id="adminDeleteSelected">선택 삭제</button>
<button class="btn" id="adminSignOut">관리자 로그아웃</button>
</div>
</div>

<button class="btn" id="openWriteModalBtn" style="margin-bottom:24px;background:#6b7280;color:#fff;border-color:#6b7280;box-shadow:0 2px 8px rgba(0,0,0,.1)">📋 견적 요청하기</button>

<div style="background:#fff;border-radius:16px;padding:20px;box-shadow:0 2px 12px rgba(0,0,0,.06);margin-bottom:20px">
<div class="toolbar">
<input id="searchBox" placeholder="🔍 이름, 내용, 공간 유형으로 검색" type="text" style="flex:1;border:1px solid #e5e7eb;border-radius:10px;padding:12px 16px;font-size:14px"/>
</div>

<div class="table-wrap"><table class="table" id="estimateTable" style="background:#fff">
<thead><tr><th style="width:32px"><input id="selectAll" type="checkbox"/></th><th style="width:60px;text-align:center">번호</th><th style="width:120px">이름</th><th style="width:140px">공간</th><th>내용</th><th style="width:100px;text-align:center">등록일</th><th style="width:90px;text-align:center">관리</th></tr></thead>
<tbody id="estimateTbody"></tbody>
</table></div>
</div>
<div class="pager" id="pager"></div>

<details style="margin-top:30px"><summary>관리자 로그인</summary>
<div id="adminLoginForm" style="margin-top:8px">
<input id="adminPasswordInput" name="pwd" placeholder="비밀번호" type="password" style="padding:10px;margin-bottom:8px;width:100%;max-width:300px"/>
<button class="btn pri" type="button" id="adminLoginBtn">로그인</button>
</div>
</details>
</div>
</div>
</div>
<!-- 등록 모달 -->
<div class="write-modal" id="writeModal">
<div class="write-modal-box">
<div class="write-modal-header">
<h4>견적 요청 등록</h4>
<button class="close-x" id="closeWriteModal">&times;</button>
</div>
<div id="estimateForm">
<div class="write-modal-body">
<div style="margin-bottom:20px;padding:12px;background:#f8f9fb;border-radius:8px">
<div style="display:flex;align-items:center;justify-content:space-between">
<span style="font-weight:600">공개 설정</span>
<label style="display:flex;align-items:center;gap:8px;margin:0;cursor:pointer">
<input type="checkbox" id="isPrivateToggle" style="width:auto"/>
<span>비공개</span>
</label>
</div>
</div>
<div style="margin-bottom:20px" id="passwordField" style="display:none">
<label>비밀번호 (4자리) <span class="req">*</span></label>
<input name="password" type="password" placeholder="비밀번호 4자리" maxlength="4" pattern="[0-9]{4}" disabled/>
<span class="help">비공개 견적은 비밀번호로 보호됩니다</span>
</div>
<div style="margin-bottom:20px">
<label>이름 <span class="req">*</span></label>
<input name="name" placeholder="홍길동" required type="text"/>
</div>
<div style="margin-bottom:20px">
<label>연락처 <span class="req">*</span></label>
<input name="phone" placeholder="010-1234-5678" required type="text"/>
</div>
<div style="margin-bottom:20px">
<label>이메일</label>
<input name="email" placeholder="example@email.com" type="email"/>
<span class="help">이메일은 선택사항입니다</span>
</div>
<div style="margin-bottom:20px">
<label>공간 유형 <span class="req">*</span></label>
<input name="spaceType" placeholder="예: 아파트 33평, 상가 20평" required type="text"/>
</div>
<div style="margin-bottom:20px">
<label>내용 <span class="req">*</span></label>
<textarea name="content" placeholder="원하시는 시공 범위/예산/희망 일정 등을 적어주세요." required></textarea>
<div class="counter" id="contentCounter">0 / 500</div>
</div>
</div>
<div class="write-modal-footer">
<button class="btn ghost" type="button" id="cancelWriteModal">취소</button>
<button class="btn pri" type="button" id="submitEstimateBtn">등록하기</button>
</div>
</div>
</div>
</div>
</div>

<!-- 견적서 작성 모달 -->
<div class="quote-modal" id="quoteModal">
<div class="quote-modal-box">
<div class="quote-modal-header">
<h4>📄 견적서 작성</h4>
<button class="close-btn" id="closeQuoteModal">✕</button>
</div>
<div class="quote-modal-body">
<form id="quoteForm">
<!-- 고객 정보 -->
<div class="form-section">
<h5>고객 정보</h5>
<div class="form-row">
<div class="form-group">
<label>성함 <span class="req">*</span></label>
<input type="text" id="q_customerName" required />
</div>
<div class="form-group">
<label>연락처 <span class="req">*</span></label>
<input type="text" id="q_customerPhone" placeholder="010-0000-0000" required />
</div>
</div>
<div class="form-group">
<label>시공 주소</label>
<input type="text" id="q_customerAddress" placeholder="예) 경기도 고양시 일산동구..." />
</div>
</div>

<!-- 시공 내역 -->
<div class="form-section">
<h5>시공 내역</h5>
<div id="quoteItems">
<div class="quote-item">
<div class="item-row">
<input type="text" class="item-name" placeholder="품목" />
<input type="text" class="item-spec" placeholder="규격" />
<input type="number" class="item-qty" placeholder="수량" value="1" />
<input type="number" class="item-price" placeholder="단가" />
<span class="item-total">0원</span>
<button type="button" class="btn-remove" onclick="removeQuoteItem(this)">−</button>
</div>
</div>
</div>
<button type="button" class="btn ghost" id="addQuoteItem" style="margin-top:10px">+ 항목 추가</button>
</div>

<!-- 금액 정보 -->
<div class="form-section">
<h5>금액 정보</h5>
<div class="total-info">
<div class="total-row">
<span>공급가액:</span>
<span id="supplyAmount">0원</span>
</div>
<div class="total-row">
<span>부가세 (10%):</span>
<span id="taxAmount">0원</span>
</div>
<div class="total-row total-final">
<span>총 금액:</span>
<span id="totalAmount">0원</span>
</div>
</div>
</div>

<!-- 비고 -->
<div class="form-section">
<h5>특이사항 / 비고</h5>
<textarea id="q_notes" rows="4" placeholder="특이사항이나 추가 안내사항을 입력하세요"></textarea>
</div>
</form>
</div>
<div class="quote-modal-footer">
<button class="btn ghost" type="button" id="cancelQuoteModal">취소</button>
<button class="btn pri" type="button" id="downloadQuotePDF">🖨️ 인쇄 미리보기</button>
</div>
</div>
</div>

</div><script>
(function(){
  // ---- Firebase 초기화 ----
  const firebaseConfig = {
    apiKey: "AIzaSyDcGo7RFr_RwHIpcJ1cYy4HZG_azPZrUaE",
    authDomain: "dsinterior-b30c0.firebaseapp.com",
    projectId: "dsinterior-b30c0",
    storageBucket: "dsinterior-b30c0.firebasestorage.app",
    messagingSenderId: "415692346183",
    appId: "1:415692346183:web:5b1eeead1ee9ef963bf262",
    measurementId: "G-3P3DK96EG5"
  };

  // Firebase 초기화
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const estimatesCollection = db.collection('estimates');

  // ---- UI helpers ----
  function toast(msg){
    let t = document.querySelector('.toast');
    if(!t){ t = document.createElement('div'); t.className='toast'; document.body.appendChild(t); }
    t.textContent = msg; t.classList.add('show');
    setTimeout(()=> t.classList.remove('show'), 1800);
  }
  function isPhoneOrEmail(v){
    v = (v||'').trim();
    const phone = /^0\d{1,2}-?\d{3,4}-?\d{4}$/;
    const email = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return phone.test(v) || email.test(v);
  }

  const CM_KEY='dsinterior_comments_v1';
  const PAGE_SIZE=10;
  let state={
    items:[],
    page:1,
    q:'',
    admin:false,
    selected: new Set()
  };

  // Firestore에서 데이터 로드
  async function load(){
    try {
      const snapshot = await estimatesCollection.orderBy('createdAt', 'desc').get();
      state.items = snapshot.docs.map(doc => ({
        id: doc.id,
        hidden: false,
        ...doc.data()
      }));
      
      // 데이터가 없으면 seed 데이터 추가
      if(state.items.length === 0) {
        const seedData = [
          {id:'seed1', name:'김**', phone:'010-****-1234', email:'', spaceType:'아파트 33평', content:'거실/주방 확장과 전체 도장, 욕실 교체 견적 문의드립니다', createdAt:new Date(Date.now()-86400000*2).toISOString(), isPrivate:false, password:'', hidden:false},
          {id:'seed2', name:'박**', phone:'010-****-5678', email:'park@example.com', spaceType:'상가 20평', content:'카페 인테리어(바, 조명, 벽면 시공) 견적 희망합니다', createdAt:new Date(Date.now()-86400000*4).toISOString(), isPrivate:true, password:'1234', hidden:false},
          {id:'seed3', name:'이**', phone:'010-****-9012', email:'', spaceType:'오피스텔 15평', content:'원룸 구조 전체 인테리어 견적 요청', createdAt:new Date(Date.now()-86400000*7).toISOString(), isPrivate:false, password:'', hidden:false}
        ];
        
        for(const item of seedData) {
          await estimatesCollection.doc(item.id).set(item);
        }
        state.items = seedData;
      }
      
      render();
    } catch(e) {
      console.error('Firestore 로드 오류:', e);
      toast('데이터 로드 중 오류가 발생했습니다.');
    }
  }

  // Firestore에 데이터 저장 (개별 항목)
  async function saveItem(item){
    try {
      await estimatesCollection.doc(item.id).set(item);
    } catch(e) {
      console.error('Firestore 저장 오류:', e);
      toast('저장 중 오류가 발생했습니다.');
    }
  }

  // Firestore에서 데이터 삭제
  async function deleteItem(id){
    try {
      await estimatesCollection.doc(id).delete();
    } catch(e) {
      console.error('Firestore 삭제 오류:', e);
      toast('삭제 중 오류가 발생했습니다.');
    }
  }

  function $(s){return document.querySelector(s)}
  function $all(s){return Array.from(document.querySelectorAll(s))}

  const mask = $('#estimateModalMask');
  const writeModal = $('#writeModal');
  
  function openModal(){ 
    if(!mask) return; 
    mask.classList.add('show'); 
    document.body.style.overflow='hidden'; 
    refreshCounts(); 
    render(); 
  }
  window.openEstimateModal=openModal;
  
  function closeModal(){ 
    if(!mask) return; 
    mask.classList.remove('show'); 
    document.body.style.overflow=''; 
  }
  window.closeEstimateModal=closeModal;

  function openWriteModal(){
    console.log('openWriteModal 호출됨');
    if(!writeModal) {
      console.error('writeModal 요소를 찾을 수 없습니다');
      return;
    }
    writeModal.classList.add('show');
    console.log('모달 표시됨');
    setTimeout(()=>{ 
      const nameInput = document.querySelector('#estimateForm input[name=name]');
      if(nameInput) nameInput.focus();
      
      // 토글 이벤트 리스너 추가
      const toggle = document.getElementById('isPrivateToggle');
      const passwordField = document.querySelector('#passwordField');
      const passwordInput = document.querySelector('input[name=password]');
      
      if(toggle && passwordField && passwordInput){
        toggle.addEventListener('change', function(){
          if(this.checked){
            passwordField.style.display = 'block';
            passwordInput.disabled = false;
            passwordInput.required = true;
          }else{
            passwordField.style.display = 'none';
            passwordInput.disabled = true;
            passwordInput.required = false;
            passwordInput.value = '';
          }
        });
      }
    }, 100);
  }
  
  function closeWriteModal(){
    if(!writeModal) return;
    writeModal.classList.remove('show');
    
    // 수동으로 폼 초기화
    const formEl = document.getElementById('estimateForm');
    if(formEl){
      const nameInput = formEl.querySelector('input[name="name"]');
      const phoneInput = formEl.querySelector('input[name="phone"]');
      const emailInput = formEl.querySelector('input[name="email"]');
      const spaceTypeInput = formEl.querySelector('input[name="spaceType"]');
      const contentInput = formEl.querySelector('textarea[name="content"]');
      const passwordInput = formEl.querySelector('input[name="password"]');
      
      if(nameInput) nameInput.value = '';
      if(phoneInput) phoneInput.value = '';
      if(emailInput) emailInput.value = '';
      if(spaceTypeInput) spaceTypeInput.value = '';
      if(contentInput) contentInput.value = '';
      if(passwordInput) passwordInput.value = '';
    }
    
    const counter = document.getElementById('contentCounter');
    if(counter) counter.textContent = '0 / 500';
    
    // 토글 초기화
    const toggle = document.getElementById('isPrivateToggle');
    const passwordField = document.querySelector('#passwordField');
    const passwordInput = document.querySelector('input[name=password]');
    if(toggle) toggle.checked = false;
    if(passwordField) passwordField.style.display = 'none';
    if(passwordInput){
      passwordInput.disabled = true;
      passwordInput.required = false;
      passwordInput.value = '';
    }
  }

  $('#openEstimateBtn')?.addEventListener('click', openModal);
  document.addEventListener('click', function(e){
    const t=e.target.closest('#openEstimateBtn,[data-open="estimate"]');
    if(t){ e.preventDefault(); openModal(); }
  });
  $('#closeEstimateModal')?.addEventListener('click', closeModal);
  
  // 초기화 함수
  function initEventListeners(){
    const openWriteBtn = document.getElementById('openWriteModalBtn');
    const closeWriteBtn = document.getElementById('closeWriteModal');
    const cancelWriteBtn = document.getElementById('cancelWriteModal');
    const estimateForm = document.getElementById('estimateForm');
    const searchBox = document.getElementById('searchBox');
    const adminLoginForm = document.getElementById('adminLoginForm');
    const adminSignOut = document.getElementById('adminSignOut');
    const adminDeleteSelected = document.getElementById('adminDeleteSelected');
    const adminHideToggled = document.getElementById('adminHideToggled');
    const selectAll = document.getElementById('selectAll');
    
    console.log('초기화 중...', {
      openWriteBtn: !!openWriteBtn,
      estimateForm: !!estimateForm,
      adminLoginForm: !!adminLoginForm
    });
    
    if(openWriteBtn) {
      openWriteBtn.addEventListener('click', openWriteModal);
      console.log('견적 등록 버튼 이벤트 등록됨');
    } else {
      console.error('견적 등록 버튼을 찾을 수 없습니다');
    }
    
    if(closeWriteBtn) closeWriteBtn.addEventListener('click', closeWriteModal);
    if(cancelWriteBtn) cancelWriteBtn.addEventListener('click', closeWriteModal);
    
    const wm = document.getElementById('writeModal');
    if(wm) wm.addEventListener('click', (e)=>{ if(e.target===wm) closeWriteModal() });

    // Form submit → button click으로 변경
    const submitEstimateBtn = document.getElementById('submitEstimateBtn');
    if(submitEstimateBtn){
      submitEstimateBtn.addEventListener('click', async (e)=>{
        e.preventDefault();
        console.log('견적 등록 버튼 클릭됨');
        
        // 폼 데이터 수집
        const formEl = document.getElementById('estimateForm');
        const nameInput = formEl.querySelector('input[name="name"]');
        const phoneInput = formEl.querySelector('input[name="phone"]');
        const emailInput = formEl.querySelector('input[name="email"]');
        const spaceTypeInput = formEl.querySelector('input[name="spaceType"]');
        const contentInput = formEl.querySelector('textarea[name="content"]');
        
        const isPrivate = document.getElementById('isPrivateToggle')?.checked || false;
        const passwordInput = formEl.querySelector('input[name="password"]');
        const password = isPrivate ? (passwordInput?.value || '').trim() : '';
        
        const item={
          id: 'e_'+Date.now(),
          name: (nameInput?.value || '').trim(),
          phone: (phoneInput?.value || '').trim(),
          email: (emailInput?.value || '').trim(),
          spaceType: (spaceTypeInput?.value || '').trim(),
          content: (contentInput?.value || '').trim(),
          createdAt: new Date().toISOString(),
          isPrivate: isPrivate,
          password: password,
          hidden:false
        };
        
        console.log('등록할 데이터:', item);
        
        if(!item.name || !item.phone || !item.content){ 
          toast('필수 항목을 입력해주세요.'); 
          return; 
        }
        
        // 연락처 유효성 검사
        const phonePattern = /^0\d{1,2}-?\d{3,4}-?\d{4}$/;
        if(!phonePattern.test(item.phone)){ 
          toast('❌ 올바른 휴대폰 번호를 입력해주세요. (예: 010-1234-5678)'); 
          alert('올바른 휴대폰 번호를 입력해주세요.\n\n형식: 010-1234-5678 또는 01012345678');
          return; 
        }
        
        if(item.content.length>500){ 
          toast('내용은 500자 이내로 작성해주세요.'); 
          return; 
        }
        
        if(isPrivate && password.length !== 4){
          toast('비밀번호는 4자리 숫자여야 합니다.');
          return;
        }
        
        state.items.unshift(item);
        await saveItem(item);
        
        // 폼 초기화
        if(nameInput) nameInput.value = '';
        if(phoneInput) phoneInput.value = '';
        if(emailInput) emailInput.value = '';
        if(spaceTypeInput) spaceTypeInput.value = '';
        if(contentInput) contentInput.value = '';
        if(passwordInput) passwordInput.value = '';
        const privateToggle = document.getElementById('isPrivateToggle');
        if(privateToggle) privateToggle.checked = false;
        
        state.page=1;
        render();
        closeWriteModal();
        toast('견적 요청이 등록되었습니다!');
        console.log('등록 완료');
      });
      console.log('견적 등록 버튼 이벤트 등록됨');
    } else {
      console.error('견적 등록 버튼을 찾을 수 없습니다');
    }

    // Search
    if(searchBox){
      searchBox.addEventListener('input', (e)=>{ 
        state.q = e.target.value.trim(); 
        state.page=1; 
        render(); 
      });
    }

    // Admin login → button click으로 변경
    const adminLoginBtn = document.getElementById('adminLoginBtn');
    if(adminLoginBtn){
      adminLoginBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        const passwordInput = document.getElementById('adminPasswordInput');
        const pwd = passwordInput?.value || '';
        console.log('관리자 로그인 시도');
        if(pwd==='2259'){ 
          setAdmin(true); 
          if(passwordInput) passwordInput.value = '';
          toast('관리자 모드 활성화');
        }
        else {
          alert('비밀번호가 올바르지 않습니다.');
          toast('비밀번호가 올바르지 않습니다.');
        }
      });
      console.log('관리자 로그인 버튼 이벤트 등록됨');
    } else {
      console.error('관리자 로그인 버튼을 찾을 수 없습니다');
    }
    
    if(adminSignOut) adminSignOut.addEventListener('click', ()=> setAdmin(false));
    
    if(adminDeleteSelected){
      adminDeleteSelected.addEventListener('click', ()=>{
        console.log('=== 삭제 버튼 클릭됨 ===');
        console.log('선택된 항목 수:', state.selected.size);
        console.log('선택된 ID들:', Array.from(state.selected));
        
        if(state.selected.size===0) {
          alert('삭제할 항목을 선택해주세요.');
          toast('삭제할 항목을 선택해주세요.');
          return;
        }
        
        // 커스텀 확인 모달 생성
        const confirmModal = document.createElement('div');
        confirmModal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:9999999;';
        confirmModal.innerHTML = `
          <div style="background:#fff;padding:32px;border-radius:12px;width:90%;max-width:400px;box-shadow:0 20px 60px rgba(0,0,0,0.3);">
            <h3 style="margin:0 0 16px 0;font-size:1.5rem;text-align:center;">⚠️ 삭제 확인</h3>
            <p style="margin:0 0 24px 0;color:#666;text-align:center;line-height:1.6;">선택한 ${state.selected.size}개 항목을 삭제할까요?<br><span style="color:#dc2626;font-size:0.9rem;">삭제된 데이터는 복구할 수 없습니다.</span></p>
            <div style="display:flex;gap:8px;">
              <button id="confirmCancel" style="flex:1;padding:12px;background:#e5e7eb;border:none;border-radius:8px;font-weight:600;cursor:pointer;">취소</button>
              <button id="confirmDelete" style="flex:1;padding:12px;background:#dc2626;color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;">삭제</button>
            </div>
          </div>
        `;
        document.body.appendChild(confirmModal);
        
        const confirmCancel = document.getElementById('confirmCancel');
        const confirmDelete = document.getElementById('confirmDelete');
        
        confirmCancel.addEventListener('click', () => {
          console.log('사용자가 취소함');
          document.body.removeChild(confirmModal);
        });
        
        confirmDelete.addEventListener('click', async () => {
          console.log('사용자가 삭제 확인함');
          console.log('삭제 전 항목 수:', state.items.length);
          
          // Firestore에서 삭제
          const deletePromises = Array.from(state.selected).map(id => deleteItem(id));
          await Promise.all(deletePromises);
          
          state.items = state.items.filter(x => !state.selected.has(x.id));
          console.log('삭제 후 항목 수:', state.items.length);
          
          state.selected.clear(); 
          render();
          toast('삭제되었습니다.');
          console.log('삭제 완료');
          
          document.body.removeChild(confirmModal);
        });
        
        confirmModal.addEventListener('click', (e) => {
          if(e.target === confirmModal){
            document.body.removeChild(confirmModal);
          }
        });
      });
      console.log('✅ 삭제 버튼 이벤트 등록됨');
    } else {
      console.error('❌ adminDeleteSelected 버튼을 찾을 수 없습니다');
    }
    
    if(adminHideToggled){
      adminHideToggled.addEventListener('click', async ()=>{
        if(state.selected.size===0) return;
        
        // Firestore 업데이트
        const updatePromises = Array.from(state.selected).map(async id => {
          const item = state.items.find(x => x.id === id);
          if(item) {
            const updatedItem = {...item, hidden: !item.hidden};
            await saveItem(updatedItem);
            return updatedItem;
          }
        });
        await Promise.all(updatePromises);
        
        state.items = state.items.map(x=> state.selected.has(x.id)? {...x, hidden:!x.hidden}: x);
        render();
      });
    }
    
    if(selectAll){
      selectAll.addEventListener('change', (e)=>{
        const checked = e.target.checked;
        const ids = Array.from(document.querySelectorAll('#estimateTbody input[type=checkbox].rowSel')).map(x=>x.dataset.id);
        state.selected.clear();
        if(checked) ids.forEach(id=>state.selected.add(id));
        renderTbody();
      });
    }
  }

  // Admin function
  function setAdmin(on){ 
    state.admin=!!on; 
    
    // localStorage에 관리자 상태 저장
    if(on) {
      localStorage.setItem('dsinterior_admin', 'true');
    } else {
      localStorage.removeItem('dsinterior_admin');
    }
    
    const adminBar = document.getElementById('adminBar');
    if(adminBar) adminBar.style.display = on?'flex':'none'; 
    render(); 
  }

  function filterItems(){
    const q = state.q.toLowerCase();
    let arr = state.items.filter(x=>!x.hidden || state.admin);
    if(q){
      const phone = x => x.phone || x.contact || '';
      const email = x => x.email || '';
      arr = arr.filter(x=>(x.name+' '+phone(x)+' '+email(x)+' '+x.spaceType+' '+x.content).toLowerCase().includes(q));
    }
    return arr;
  }

  function fmt(d){ try{const dt=new Date(d);return dt.toLocaleString()}catch(e){return d} }

  function renderTbody(){
    const tbody = document.getElementById('estimateTbody');
    tbody.innerHTML='';
    const filtered = filterItems();
    const start = (state.page-1)*PAGE_SIZE;
    const pageItems = filtered.slice(start, start+PAGE_SIZE);
    // visibleRange 업데이트 제거 (삭제 요청)
    
    if(pageItems.length===0){
      tbody.innerHTML = '<tr><td colspan="7" class="empty">등록된 견적 요청이 없습니다</td></tr>';
      return;
    }
    
    pageItems.forEach((it,idx)=>{
      const tr = document.createElement('tr');
      const checked = state.selected.has(it.id) ? 'checked' : '';
      const num = filtered.length - start - idx;
      const date = new Date(it.createdAt);
      const dateStr = `${date.getFullYear()}.${String(date.getMonth()+1).padStart(2,'0')}.${String(date.getDate()).padStart(2,'0')}`;
      const privateLabel = it.isPrivate ? ' <span class="badge" style="background:#fee;color:#c00">비공개</span>' : '';
      
      // 비공개 게시물이고 관리자가 아닌 경우 마스킹 처리
      let displayName = it.name;
      let displayContent = it.content;
      
      if(it.isPrivate && !state.admin){
        // 이름 마스킹: 첫 글자만 보이고 나머지는 *
        displayName = it.name.charAt(0) + '*'.repeat(it.name.length - 1);
        displayContent = '비공개 견적입니다';
      }
      
      // 댓글 개수 확인
      const commentCount = it.comments ? it.comments.length : 0;
      const commentBadge = commentCount > 0 ? `<span class="comment-badge">${commentCount}</span>` : '';
      
      tr.innerHTML = `
        <td style="width:32px"><input type="checkbox" class="rowSel" data-id="${it.id}" ${checked}></td>
        <td style="width:60px;text-align:center">${num}</td>
        <td style="width:120px">${displayName}${it.hidden? ' <span class="badge">숨김</span>':''}${privateLabel}</td>
        <td style="width:140px;text-align:center"><span class="space-badge">${it.spaceType||'-'}</span></td>
        <td title="${displayContent.replace(/"/g,'&quot;')}">${displayContent.length>60? displayContent.slice(0,60)+'…': displayContent}</td>
        <td style="width:100px;text-align:center">${dateStr}</td>
        <td style="width:90px;text-align:center">
          <div class="kebab" style="display:flex;align-items:center;justify-content:center;">
            <div style="position:relative;display:inline-block;">
              <button class="btn ghost btn-small" data-act="view" data-id="${it.id}">보기</button>
              ${commentBadge}
            </div>
          </div>
        </td>`;
      tbody.appendChild(tr);
    });
    
    // 체크박스 이벤트 등록
    $all('#estimateTbody input.rowSel').forEach(cb=>{
      cb.addEventListener('change', (e)=>{
        const id=e.target.dataset.id;
        if(e.target.checked) {
          state.selected.add(id);
          console.log('선택됨:', id, '총:', state.selected.size);
        } else {
          state.selected.delete(id);
          console.log('선택 해제:', id, '총:', state.selected.size);
        }
      });
    });
    // view buttons
    $all('button[data-act=view]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const it = state.items.find(x=>x.id===btn.dataset.id);
        if(!it) return;
        
        console.log('게시물 정보:', {
          id: it.id,
          isPrivate: it.isPrivate,
          password: it.password,
          isAdmin: state.admin
        });
        
        // 비공개 게시물이고 관리자가 아닌 경우 비밀번호 확인
        if(it.isPrivate && !state.admin){
          console.log('비공개 게시물 - 비밀번호 확인 필요');
          
          // 커스텀 비밀번호 입력 모달 생성
          const pwdModal = document.createElement('div');
          pwdModal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:9999999;';
          pwdModal.innerHTML = `
            <div style="background:#fff;padding:32px;border-radius:12px;width:90%;max-width:400px;box-shadow:0 20px 60px rgba(0,0,0,0.3);">
              <h3 style="margin:0 0 20px 0;font-size:1.5rem;text-align:center;">🔒 비공개 견적</h3>
              <p style="margin:0 0 20px 0;color:#666;text-align:center;">비밀번호 4자리를 입력하세요</p>
              <input type="password" id="pwdInput" maxlength="4" style="width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:8px;font-size:1.2rem;text-align:center;letter-spacing:0.5em;" placeholder="••••">
              <div style="display:flex;gap:8px;margin-top:20px;">
                <button id="pwdCancel" style="flex:1;padding:12px;background:#e5e7eb;border:none;border-radius:8px;font-weight:600;cursor:pointer;">취소</button>
                <button id="pwdConfirm" style="flex:1;padding:12px;background:#3b82f6;color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;">확인</button>
              </div>
            </div>
          `;
          document.body.appendChild(pwdModal);
          
          const pwdInput = document.getElementById('pwdInput');
          const pwdCancel = document.getElementById('pwdCancel');
          const pwdConfirm = document.getElementById('pwdConfirm');
          
          pwdInput.focus();
          
          const checkPassword = () => {
            const inputPwd = pwdInput.value.trim();
            console.log('입력된 비밀번호:', inputPwd, '저장된 비밀번호:', it.password);
            
            if(!inputPwd){
              alert('비밀번호를 입력하세요.');
              return false;
            }
            
            const inputStr = String(inputPwd).trim();
            const savedStr = String(it.password || '').trim();
            console.log('비교:', {input: inputStr, saved: savedStr, match: inputStr === savedStr});
            
            if(inputStr !== savedStr){
              console.log('비밀번호 불일치');
              alert('❌ 비밀번호가 일치하지 않습니다.');
              pwdInput.value = '';
              pwdInput.focus();
              return false;
            }
            
            console.log('비밀번호 일치 - 상세보기 진행');
            document.body.removeChild(pwdModal);
            showDetailModal(it);
            return true;
          };
          
          pwdConfirm.addEventListener('click', checkPassword);
          pwdCancel.addEventListener('click', () => {
            console.log('비밀번호 입력 취소됨');
            document.body.removeChild(pwdModal);
          });
          
          pwdInput.addEventListener('keypress', (e) => {
            if(e.key === 'Enter') checkPassword();
          });
          
          pwdModal.addEventListener('click', (e) => {
            if(e.target === pwdModal){
              document.body.removeChild(pwdModal);
            }
          });
          
          return; // 비밀번호 확인 후 showDetailModal에서 처리
        }
        
        // 공개 게시물이거나 관리자인 경우 바로 표시
        showDetailModal(it);
      });
    });
  }
  
  // 상세 모달 표시 함수 분리
  function showDetailModal(it){
        function maskPhone(phone){
          if(!phone || phone === '-') return '-';
          // 010-1234-5678 → 010-****-5678
          const cleaned = phone.replace(/-/g, '');
          if(cleaned.length === 11){
            return cleaned.substring(0,3) + '-****-' + cleaned.substring(7);
          } else if(cleaned.length === 10){
            return cleaned.substring(0,3) + '-***-' + cleaned.substring(6);
          }
          return phone.substring(0, 3) + '****' + phone.substring(phone.length-4);
        }
        
        function maskEmail(email){
          if(!email || email === '-') return '-';
          const [local, domain] = email.split('@');
          if(!domain) return email;
          // example@email.com → ex****@email.com
          const maskedLocal = local.substring(0, Math.min(2, local.length)) + '****';
          return maskedLocal + '@' + domain;
        }
        
        // 상세 정보 모달 표시
        let phone = it.phone || it.contact || '-';
        let email = it.email || '-';
        
        // 관리자가 아니면 마스킹 처리
        if(!state.admin){
          phone = maskPhone(phone);
          email = maskEmail(email);
        }
        
        const privateLabel = it.isPrivate ? ' [비공개]' : '';
        const date = new Date(it.createdAt);
        const dateStr = `${date.getFullYear()}년 ${date.getMonth()+1}월 ${date.getDate()}일`;
        
        const detailHTML = `
          <div class="detail-modal-content" style="padding:32px;max-width:100%;">
            <h3 class="detail-modal-title" style="margin:0 0 24px 0;font-size:1.6rem;border-bottom:2px solid #e5e7eb;padding-bottom:16px;text-align:left;color:#111827;font-weight:700;display:flex;align-items:center;gap:10px;">
              <span style="display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;background:#eff6ff;border-radius:10px;font-size:1.2rem;">📄</span>
              견적 요청 상세${privateLabel}
            </h3>
            <div class="detail-info-grid" style="background:#f9fafb;padding:24px;border-radius:12px;margin-bottom:24px;border:1px solid #e5e7eb;">
              <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;">
                <div>
                  <strong class="detail-label" style="color:#6b7280;font-size:0.85rem;display:block;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.05em;">작성자</strong>
                  <div class="detail-value" style="font-size:1.1rem;font-weight:600;color:#111827;">${it.name}</div>
                </div>
                <div>
                  <strong class="detail-label" style="color:#6b7280;font-size:0.85rem;display:block;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.05em;">연락처</strong>
                  <div class="detail-value" style="font-size:1.1rem;font-weight:600;color:#111827;">${phone}</div>
                </div>
                ${email !== '-' ? `
                <div>
                  <strong class="detail-label" style="color:#6b7280;font-size:0.85rem;display:block;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.05em;">이메일</strong>
                  <div class="detail-value" style="font-size:1.1rem;font-weight:600;color:#111827;">${email}</div>
                </div>
                ` : ''}
                <div>
                  <strong class="detail-label" style="color:#6b7280;font-size:0.85rem;display:block;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.05em;">공간 유형</strong>
                  <div class="detail-value" style="font-size:1.1rem;font-weight:600;color:#111827;">${it.spaceType||'-'}</div>
                </div>
                <div>
                  <strong class="detail-label" style="color:#6b7280;font-size:0.85rem;display:block;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.05em;">등록일</strong>
                  <div class="detail-value" style="font-size:1.1rem;font-weight:600;color:#111827;">${dateStr}</div>
                </div>
              </div>
            </div>
            <div>
              <strong class="detail-label" style="color:#6b7280;font-size:0.85rem;display:block;margin-bottom:12px;text-transform:uppercase;letter-spacing:0.05em;">상세 내용</strong>
              <div class="detail-content" style="padding:20px;background:#fff;border:1px solid #e5e7eb;border-radius:12px;line-height:1.8;white-space:pre-wrap;font-size:1rem;min-height:120px;color:#374151;">${it.content}</div>
            </div>
            
            <!-- 댓글 섹션 (항상 표시) -->
            <div class="detail-comments" style="margin-top:24px;border-top:1px solid #e5e7eb;padding-top:24px;">
              <strong class="detail-label" style="color:#6b7280;font-size:0.85rem;display:block;margin-bottom:12px;text-transform:uppercase;letter-spacing:0.05em;">💬 대성기획인테리어 댓글</strong>
              <div id="commentsList_${it.id}" style="margin-bottom:16px;"></div>
              
              ${state.admin ? `
              <!-- 댓글 입력창 (관리자만) -->
              <div style="display:flex;gap:8px;">
                <input type="text" id="commentInput_${it.id}" placeholder="댓글을 입력하세요..." style="flex:1;padding:12px 14px;border:1px solid #e5e7eb;border-radius:10px;font-size:0.95rem;">
                <button onclick="addComment('${it.id}')" style="padding:10px 20px;background:#3b82f6;color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;white-space:nowrap;" onmouseover="this.style.background='#2563eb'" onmouseout="this.style.background='#3b82f6'">등록</button>
              </div>
              ` : ''}
            </div>
            
            <div style="margin-top:28px;text-align:center;">
              <button class="detail-close-btn" onclick="closeDetailModal()" style="padding:12px 32px;background:#f3f4f6;color:#374151;border:none;border-radius:10px;font-weight:600;cursor:pointer;font-size:1rem;transition:background 0.2s;" onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">닫기</button>
            </div>
          </div>
        `;
        
        // 모달 생성
        let detailModal = document.getElementById('detailModal');
        if(!detailModal){
          detailModal = document.createElement('div');
          detailModal.id = 'detailModal';
          detailModal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:999999;padding:20px;';
          document.body.appendChild(detailModal);
        }
        
        detailModal.innerHTML = `
          <div style="background:#fff;border-radius:16px;width:100%;max-width:800px;max-height:90vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,.15);">
            ${detailHTML}
          </div>
        `;
        
        detailModal.style.display = 'flex';
        
        // 댓글 렌더링 (항상 실행)
        renderComments(it.id);
        
        // 배경 클릭 시 닫기
        detailModal.addEventListener('click', function(e){
          if(e.target === detailModal){
            detailModal.style.display = 'none';
          }
        });
  }
  
  // 상세 모달 닫기 함수 (전역)
  window.closeDetailModal = function(){
    const detailModal = document.getElementById('detailModal');
    if(detailModal) detailModal.style.display = 'none';
  };
  
  // 댓글 렌더링
  window.renderComments = function(itemId){
    const item = state.items.find(x => x.id === itemId);
    if(!item) return;
    
    const commentsList = document.getElementById(`commentsList_${itemId}`);
    if(!commentsList) return;
    
    if(!item.comments || item.comments.length === 0){
      commentsList.innerHTML = '<div class="no-comments" style="color:#999;text-align:center;padding:20px;">등록된 댓글이 없습니다.</div>';
      return;
    }
    
    let html = '';
    item.comments.forEach((comment, idx) => {
      html += `
        <div class="comment-item" style="background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:12px;margin-bottom:8px;">
          <div class="comment-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
            <span class="comment-author" style="font-weight:600;color:#111;">대성기획인테리어</span>
            <span class="comment-date" style="font-size:0.85rem;color:#999;">${new Date(comment.date).toLocaleString()}</span>
          </div>
          <div class="comment-text" style="color:#333;line-height:1.6;">${comment.text}</div>
        </div>
      `;
    });
    
    commentsList.innerHTML = html;
  };
  
  // 댓글 추가
  window.addComment = async function(itemId){
    const input = document.getElementById(`commentInput_${itemId}`);
    if(!input) return;
    
    const text = input.value.trim();
    if(!text){
      alert('댓글 내용을 입력하세요.');
      return;
    }
    
    const item = state.items.find(x => x.id === itemId);
    if(!item) return;
    
    if(!item.comments) item.comments = [];
    
    item.comments.push({
      text: text,
      date: new Date().toISOString()
    });
    
    // Firestore에 저장
    await saveItem(item);
    
    input.value = '';
    renderComments(itemId);
    toast('댓글이 등록되었습니다.');
  };

  function renderPager(){
    const filtered = filterItems();
    const pages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));
    const pager = document.getElementById('pager');
    pager.innerHTML='';
    function addBtn(label, page, active=false, disabled=false){
      const b=document.createElement('button');
      b.textContent=label;
      if(active) b.classList.add('active');
      if(disabled){ b.disabled=true; b.style.opacity=0.6; }
      b.addEventListener('click', ()=>{ state.page=page; renderTbody(); renderPager(); $('#selectAll').checked=false });
      pager.appendChild(b);
    }
    addBtn('«', 1, false, state.page===1);
    addBtn('‹', Math.max(1, state.page-1), false, state.page===1);
    for(let i=1;i<=pages;i++){
      if(i===1 || i===pages || Math.abs(i-state.page)<=2){
        addBtn(String(i), i, i===state.page);
      }else if(Math.abs(i-state.page)===3){
        const span=document.createElement('span'); span.textContent='…'; span.style.margin='0 6px'; pager.appendChild(span);
      }
    }
    addBtn('›', Math.min(pages, state.page+1), false, state.page===pages);
    addBtn('»', pages, false, state.page===pages);
  }

  function refreshCounts(){
    const total = state.items.filter(x=>!x.hidden || state.admin).length;
    document.getElementById('estimateCountBadge').textContent = `총 ${total}건`;
  }

  function render(){
    refreshCounts();
    renderTbody();
    renderPager();
  }

  // Initialize sample data if empty to show UI
  document.addEventListener('DOMContentLoaded', async ()=>{
    // 이벤트 리스너 초기화
    initEventListeners();
    
    // 관리자 로그인 상태 복원
    const isAdmin = localStorage.getItem('dsinterior_admin') === 'true';
    if(isAdmin) {
      setAdmin(true);
    }
    
    // Firestore에서 데이터 로드 (seed 데이터 처리 포함)
    await load();
  });
})();

  // Textarea counter
  (function(){
    const ta = document.querySelector('#estimateForm textarea[name=content]');
    const counter = document.getElementById('contentCounter');
    if(ta && counter){
      const update=()=>{ const len=(ta.value||'').length; if(len>500){ ta.value=ta.value.slice(0,500); } counter.textContent = len+' / 500'; };
      ta.addEventListener('input', update); update();
    }
  })();

  // ========== 전화번호 자동 하이픈 기능 ==========
  function formatPhoneNumber(value) {
    // 숫자만 추출
    const numbers = value.replace(/[^\d]/g, '');
    
    // 길이에 따라 포맷팅
    if (numbers.length <= 3) {
      return numbers;
    } else if (numbers.length <= 7) {
      return numbers.slice(0, 3) + '-' + numbers.slice(3);
    } else if (numbers.length <= 11) {
      return numbers.slice(0, 3) + '-' + numbers.slice(3, 7) + '-' + numbers.slice(7);
    } else {
      // 11자리 넘으면 자르기
      return numbers.slice(0, 3) + '-' + numbers.slice(3, 7) + '-' + numbers.slice(7, 11);
    }
  }

  // 견적 문의 폼의 연락처 입력란
  const estimatePhoneInput = document.querySelector('input[name="phone"]');
  if(estimatePhoneInput) {
    estimatePhoneInput.addEventListener('input', function(e) {
      const formatted = formatPhoneNumber(e.target.value);
      e.target.value = formatted;
    });
  }

  // 견적서 작성 모달의 연락처 입력란
  const quotePhoneInput = document.getElementById('q_customerPhone');
  if(quotePhoneInput) {
    quotePhoneInput.addEventListener('input', function(e) {
      const formatted = formatPhoneNumber(e.target.value);
      e.target.value = formatted;
    });
  }

  // Close with ESC
  document.addEventListener('keydown', (e)=>{ 
    if(e.key==='Escape'){ 
      const writeModal = document.getElementById('writeModal');
      const boardPage = document.getElementById('estimateModalMask');
      
      if(writeModal && writeModal.classList.contains('show')){
        closeWriteModal();
      } else if(boardPage && boardPage.classList.contains('show')){
        closeModal();
      }
    } 
  });

  // ========== 견적서 작성 기능 ==========
  const quoteModal = document.getElementById('quoteModal');
  const createQuoteBtn = document.getElementById('createQuoteBtn');
  const closeQuoteModal = document.getElementById('closeQuoteModal');
  const cancelQuoteModal = document.getElementById('cancelQuoteModal');
  const downloadQuotePDF = document.getElementById('downloadQuotePDF');
  const addQuoteItem = document.getElementById('addQuoteItem');
  const quoteItems = document.getElementById('quoteItems');

  // 견적서 작성 모달 열기
  if(createQuoteBtn){
    createQuoteBtn.addEventListener('click', () => {
      quoteModal.classList.add('show');
      calculateTotal();
    });
  }

  // 견적서 모달 닫기
  if(closeQuoteModal){
    closeQuoteModal.addEventListener('click', () => {
      quoteModal.classList.remove('show');
    });
  }
  if(cancelQuoteModal){
    cancelQuoteModal.addEventListener('click', () => {
      quoteModal.classList.remove('show');
    });
  }

  // 항목 추가
  if(addQuoteItem){
    addQuoteItem.addEventListener('click', () => {
      const newItem = document.createElement('div');
      newItem.className = 'quote-item';
      newItem.innerHTML = `
        <div class="item-row">
          <input type="text" class="item-name" placeholder="품목" />
          <input type="text" class="item-spec" placeholder="규격" />
          <input type="number" class="item-qty" placeholder="수량" value="1" />
          <input type="number" class="item-price" placeholder="단가" />
          <span class="item-total">0원</span>
          <button type="button" class="btn-remove" onclick="removeQuoteItem(this)">−</button>
        </div>
      `;
      quoteItems.appendChild(newItem);
      attachItemListeners(newItem);
    });
  }

  // 항목 삭제
  window.removeQuoteItem = function(btn) {
    if(quoteItems.children.length > 1){
      btn.closest('.quote-item').remove();
      calculateTotal();
    } else {
      alert('최소 1개의 항목은 필요합니다.');
    }
  };

  // 각 항목에 이벤트 리스너 추가
  function attachItemListeners(item) {
    const qtyInput = item.querySelector('.item-qty');
    const priceInput = item.querySelector('.item-price');
    const totalSpan = item.querySelector('.item-total');

    function updateItemTotal() {
      const qty = parseInt(qtyInput.value) || 0;
      const price = parseInt(priceInput.value) || 0;
      const total = qty * price;
      totalSpan.textContent = total.toLocaleString() + '원';
      calculateTotal();
    }

    qtyInput.addEventListener('input', updateItemTotal);
    priceInput.addEventListener('input', updateItemTotal);
  }

  // 초기 항목에 리스너 추가
  document.querySelectorAll('.quote-item').forEach(attachItemListeners);

  // 전체 금액 계산
  function calculateTotal() {
    let supplyTotal = 0;
    document.querySelectorAll('.quote-item').forEach(item => {
      const qty = parseInt(item.querySelector('.item-qty').value) || 0;
      const price = parseInt(item.querySelector('.item-price').value) || 0;
      supplyTotal += qty * price;
    });

    const tax = Math.round(supplyTotal * 0.1);
    const total = supplyTotal + tax;

    document.getElementById('supplyAmount').textContent = supplyTotal.toLocaleString() + '원';
    document.getElementById('taxAmount').textContent = tax.toLocaleString() + '원';
    document.getElementById('totalAmount').textContent = total.toLocaleString() + '원';
  }

  // PDF 다운로드
  if(downloadQuotePDF){
    downloadQuotePDF.addEventListener('click', () => {
      console.log('📄 인쇄 버튼 클릭됨!');
      
      const customerName = document.getElementById('q_customerName').value;
      const customerPhone = document.getElementById('q_customerPhone').value;
      const customerAddress = document.getElementById('q_customerAddress').value;
      const notes = document.getElementById('q_notes').value;

      console.log('입력된 정보:', { customerName, customerPhone, customerAddress });

      if(!customerName || !customerPhone){
        alert('고객 정보(성함, 연락처)를 입력해주세요.');
        return;
      }

      // 항목 데이터 수집
      const items = [];
      document.querySelectorAll('.quote-item').forEach((item, index) => {
        const name = item.querySelector('.item-name').value;
        const spec = item.querySelector('.item-spec').value;
        const qty = parseInt(item.querySelector('.item-qty').value) || 0;
        const price = parseInt(item.querySelector('.item-price').value) || 0;
        const total = qty * price;

        if(name || spec || qty || price){
          items.push({ no: index + 1, name, spec, qty, price, total, category: name });
        }
      });

      console.log('수집된 항목:', items);

      if(items.length === 0){
        alert('시공 내역을 1개 이상 입력해주세요.');
        return;
      }

      console.log('인쇄 함수 호출 시작...');
      
      // 인쇄 미리보기 생성
      generateQuotePDF({
        customerName,
        customerPhone,
        customerAddress,
        items,
        notes,
        supplyAmount: document.getElementById('supplyAmount').textContent,
        taxAmount: document.getElementById('taxAmount').textContent,
        totalAmount: document.getElementById('totalAmount').textContent
      });
    });
  } else {
    console.error('❌ downloadQuotePDF 버튼을 찾을 수 없습니다!');
  }

  // 인쇄 미리보기 생성 함수
  function generateQuotePDF(data) {
    console.log('🖨️ generateQuotePDF 함수 실행!', data);
    
    // 오늘 날짜
    const today = new Date();
    const year = today.getFullYear().toString().slice(-2);
    const month = String(today.getMonth() + 1).padStart(2, '0');
    const day = String(today.getDate()).padStart(2, '0');

    // HTML 템플릿 생성 (업로드된 양식 그대로)
    const printContent = `
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <title>견적서</title>
        <style>
          @media print {
            @page { margin: 15mm; }
            body { margin: 0; }
          }
          * { box-sizing: border-box; }
          body { 
            font-family: '맑은 고딕', 'Malgun Gothic', sans-serif; 
            font-size: 11pt;
            padding: 10mm;
          }
          table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 3mm;
          }
          td, th { 
            border: 1px solid #000; 
            padding: 3px 5px;
            text-align: center;
          }
          .title { 
            text-align: center; 
            font-size: 20pt; 
            font-weight: bold; 
            letter-spacing: 8px;
            margin: 10mm 0;
          }
          .label { 
            background: #f0f0f0; 
            font-weight: bold;
            width: 15%;
          }
          .value {
            text-align: left;
            padding-left: 8px;
          }
          .header-table td {
            padding: 5px 8px;
          }
          .main-table th {
            background: #e8e8e8;
            font-weight: bold;
            padding: 6px 4px;
          }
          .main-table td {
            padding: 4px;
          }
          .category-cell {
            background: #f5f5f5;
            font-weight: bold;
          }
          .text-left { text-align: left !important; }
          .text-right { text-align: right !important; }
          .no-border { border: none !important; }
          .border-top { border-top: 2px solid #000 !important; }
        </style>
      </head>
      <body>
        <div class="title">견 적 서</div>

        <!-- 상단 정보 테이블 -->
        <table class="header-table">
          <tr>
            <td class="label" rowspan="3">공급자</td>
            <td class="value" colspan="3">20${year}년 ${month}월 ${day}일</td>
            <td class="label">현장명</td>
            <td class="value" colspan="3">${data.customerAddress || ''}</td>
          </tr>
          <tr>
            <td class="label">공급자</td>
            <td class="value" colspan="2">대성기획인테리어</td>
            <td class="label">성명</td>
            <td class="value" colspan="3">${data.customerName}</td>
          </tr>
          <tr>
            <td class="label">H.P:</td>
            <td class="value" colspan="2">010-3345-2259</td>
            <td class="label">담당자</td>
            <td class="value" colspan="3">${data.customerPhone}</td>
          </tr>
          <tr>
            <td class="label" rowspan="2">수요자</td>
            <td class="label">공사명</td>
            <td class="value" colspan="6">${data.customerAddress || ''}</td>
          </tr>
          <tr>
            <td class="label">주소</td>
            <td class="value" colspan="6">${data.customerAddress || ''}</td>
          </tr>
          <tr>
            <td class="label" rowspan="2">시공내역</td>
            <td class="label">할인</td>
            <td colspan="6" class="text-left">
              1. 할인( &nbsp; ) &nbsp; 2. 조정( &nbsp; ) &nbsp; 3. 인건비( &nbsp; ) &nbsp; 4. 단체비( &nbsp; ) &nbsp; 5. 기타( &nbsp; )
            </td>
          </tr>
          <tr>
            <td class="label">공종</td>
            <td colspan="6" class="text-left">ㅁㅁㅁ등</td>
          </tr>
        </table>

        <!-- 메인 시공 내역 테이블 -->
        <table class="main-table">
          <thead>
            <tr>
              <th style="width: 10%;">분류</th>
              <th style="width: 12%;">공종</th>
              <th style="width: 23%;">제품군</th>
              <th style="width: 15%;">모델</th>
              <th style="width: 10%;">단가</th>
              <th style="width: 8%;">단위</th>
              <th style="width: 12%;">금액</th>
              <th style="width: 10%;">비고</th>
            </tr>
          </thead>
          <tbody>
            ${generateTableRows(data.items)}
          </tbody>
        </table>

        <!-- 하단 금액 정보 -->
        <table style="margin-top: 10mm;">
          <tr>
            <td class="label" style="width: 70%;">공급가액</td>
            <td class="text-right">${data.supplyAmount}</td>
          </tr>
          <tr>
            <td class="label">부가세 (10%)</td>
            <td class="text-right">${data.taxAmount}</td>
          </tr>
          <tr style="font-weight: bold; font-size: 12pt;">
            <td class="label border-top">총 금액</td>
            <td class="text-right border-top">${data.totalAmount}</td>
          </tr>
        </table>

        ${data.notes ? `
        <div style="margin-top: 10mm; padding: 8px; border: 1px solid #000;">
          <strong>■ 특이사항:</strong><br>
          ${data.notes.replace(/\n/g, '<br>')}
        </div>
        ` : ''}

        <!-- 회사 정보 -->
        <div style="margin-top: 15mm; text-align: center; font-size: 10pt;">
          <div style="font-weight: bold; font-size: 14pt; margin-bottom: 5mm;">대성기획인테리어</div>
          <div>대표자: 윤영권 | 사업자등록번호: 612-59-01057</div>
          <div>주소: 경기도 고양시 일산동구 백석로85번길 19-11, 3층(백석동)</div>
          <div>연락처: 010-3345-2259 | 이메일: yyk2400@naver.com</div>
        </div>
      </body>
      </html>
    `;

    // 임시 iframe 생성 및 인쇄
    const iframe = document.createElement('iframe');
    iframe.style.position = 'absolute';
    iframe.style.width = '0';
    iframe.style.height = '0';
    iframe.style.border = 'none';
    iframe.style.visibility = 'hidden';
    document.body.appendChild(iframe);

    const iframeDoc = iframe.contentWindow.document;
    iframeDoc.open();
    iframeDoc.write(printContent);
    iframeDoc.close();

    // 확실하게 로드 후 인쇄 (두 가지 방법 모두 사용)
    setTimeout(() => {
      try {
        iframe.contentWindow.focus();
        iframe.contentWindow.print();
        
        // 인쇄 완료 후 iframe 제거
        setTimeout(() => {
          if(iframe.parentNode) {
            document.body.removeChild(iframe);
          }
        }, 2000);
      } catch(e) {
        console.error('인쇄 오류:', e);
        alert('인쇄 중 오류가 발생했습니다. 브라우저 설정을 확인해주세요.');
        if(iframe.parentNode) {
          document.body.removeChild(iframe);
        }
      }
    }, 500);
  }

  // 테이블 행 생성 함수
  function generateTableRows(items) {
    if(!items || items.length === 0) {
      return '<tr><td colspan="8">항목이 없습니다.</td></tr>';
    }

    let rows = '';
    let currentCategory = '';
    
    items.forEach((item, index) => {
      // 분류 셀 (첫 항목이거나 이전과 다를 때만 표시)
      const categoryCell = (index === 0 || item.category !== currentCategory) 
        ? `<td class="category-cell" rowspan="1">${item.name || '기타공사'}</td>` 
        : '';
      
      if(categoryCell) currentCategory = item.category;

      rows += `
        <tr>
          ${categoryCell}
          <td class="text-left">${item.name || ''}</td>
          <td class="text-left">${item.spec || ''}</td>
          <td>${item.spec || ''}</td>
          <td class="text-right">${item.price ? item.price.toLocaleString() : ''}</td>
          <td>${item.qty ? '식' : ''}</td>
          <td class="text-right">${item.total ? item.total.toLocaleString() : ''}</td>
          <td></td>
        </tr>
      `;
    });

    return rows;
  }

</script></body>
</html>
